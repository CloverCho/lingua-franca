 // Check ordinary output to bank of recipients.
target CCpp {
    timeout: 2 sec,
    threads: 4,
    fast: true
}; 
reactor Source {
    output out:int;
    reaction(startup) -> out {=
        SET(out, 42);
    =}
}
reactor Destination(bank_position:int(0)) {
    input in:int;
    state received:bool(false);
    reaction(in) {=
        printf("Destination %d received %d.\n", self->bank_position, in->value);
        if (42 != in->value) {
            printf("ERROR: Expected 42.\n");
            exit(1);
        }
        self->received = true;
    =}
    reaction(shutdown) {=
        if (!self->received) {
            fprintf(stderr, "ERROR: Destination %d received no input!\n", self->bank_position);
            exit(1);
        }
        printf("Success.\n");
    =}
}

main reactor MultiportToMultiport { 
    a = new Source();
    b = new[3] Destination();
    a.out -> b.in;
}