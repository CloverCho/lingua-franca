// Test bank of reactors to multiport input with id parameter in the bank.
target C;

reactor Source(bank_position:int(0)) {
    output out:int;
    
    reaction (startup) -> out {=
        SET(out, self->bank_position);
    =}
}

reactor Sink {
    input[4] in:int;
    state received:bool(false);
    
    reaction (in) {=
        for (int i = 0; i < in_width; i++) {
            printf("Received %d\n", in[i]->value);
            self->received = true;
            if (in[i]->value != i) {
                fprintf(stderr, "ERROR: expected %d\n", i);
                exit(1);    
            }
        }
    =}
    reaction(shutdown) {=
        if (!self->received) {
            fprintf(stderr, "ERROR: Sink received no data\n");
            exit(1);    
        }
    =}
}

main reactor ArrayInstancesToArrayPort {
    source = new[4] Source();
    sink = new Sink();
    source.out -> sink.in;
}