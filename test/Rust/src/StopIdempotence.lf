/* Tests that ports are cleaned up before the shutdown wave executes. */

 target Rust {
    timeout: 30 msec,
    cargo-features: ["test-program"],
 };

main reactor StopIdempotence {
    state count: u32(0);

    reaction(startup) {=
        ctx.request_stop(); // requested for (T0, 1)
        ctx.assert_tag_eq(T0);
    =}

    reaction(shutdown) {=
        ctx.request_stop(); // requested for (T0, 1)
        assert_eq!(self.count, 0, "Shutdown was run several times");
        self.count += 1;
        ctx.assert_tag_eq(MilliStep(0, 1));
        println!("success");
    =}
}
