/*
 * generated by Xtext 2.17.0
 */
package org.icyphy.tests

import com.google.inject.Inject
import org.eclipse.xtext.testing.InjectWith
import org.eclipse.xtext.testing.extensions.InjectionExtension
import org.eclipse.xtext.testing.util.ParseHelper
import org.eclipse.xtext.testing.validation.ValidationTestHelper
import org.icyphy.linguaFranca.LinguaFrancaPackage
import org.icyphy.linguaFranca.Model
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.^extension.ExtendWith

@ExtendWith(InjectionExtension)
@InjectWith(LinguaFrancaInjectorProvider)
class LinguaFrancaValidationTest {
	@Inject extension ParseHelper<Model>
    @Inject extension ValidationTestHelper

    /**
     * Ensure that duplicate identifiers for actions reported.
     */
    @Test
    def void unresolvedReactorReference() {
        val model = '''
            target TypeScript;
            main reactor Foo {
                logical action bar;
                physical action bar;
            }
        '''.parse
        
        Assertions.assertNotNull(model)
        Assertions.assertTrue(model.eResource.errors.isEmpty,
            "Encountered unexpected error while parsing: " +
                model.eResource.errors)
        model.assertError(LinguaFrancaPackage::eINSTANCE.action,
            null, // FIXME: Maybe report something descriptive here?
            'Names of contained objects (inputs, outputs, actions, timers, parameters, state, and reactors) must be unique: bar')
    }
    
    /**
     * Ensure that duplicate identifiers for actions reported.
     */
    @Test
    def void disallowCppMainCalledMain() {
        val model = '''
            target Cpp;
            main reactor Main {
            }
        '''.parse
        
        Assertions.assertNotNull(model)
        Assertions.assertTrue(model.eResource.errors.isEmpty,
            "Encountered unexpected error while parsing: " +
                model.eResource.errors)
        model.assertError(LinguaFrancaPackage::eINSTANCE.reactor,
            null,
            "Main reactor cannot be named 'Main'")
    }
}
